!function(a){a.fn.wall=function(b){function c(){wall.css({perspective:settings.perspective+"px",overflow:"hidden"}),a('<div class="wall-lightbox"><div class="wall-nav wall-back">'+settings.btnback+'</div><div class=" wall-nav wall-next">'+settings.btnnext+"</div></div>").appendTo(wall).css({position:"absolute",width:"100%",height:"100%",background:settings.lightbox,display:"none"}),a(".wall-nav").css({cursor:"pointer"})}function d(){columns=Math.ceil(items.length/settings.rows),items.each(function(a,b){b.count=a,a++,b.row=Math.ceil(a/columns)-settings.rows/2-.5,b.column=a%columns,0==b.column&&(b.column=columns),b.column=b.column-columns/2-.5,rotateY="rotateY("+(moveX*settings.variationX+-b.column)*settings.angle+"deg) ",rotateX="rotateX("+(-moveY*settings.variationY+b.row)*settings.angle+"deg) ",translateZ="translateZ("+settings.depth+"px)",items.eq(b.count).css({transform:rotateY+rotateX+translateZ})})}function e(a,b){newLeft=a-settings.size/2,newTop=b-settings.size/2,items.css({top:newTop,left:newLeft})}function f(){items.each(function(){a(this).attr("data-wall-id",itemId),itemId++}),items.css({position:"absolute",width:settings.size,height:settings.size,transition:"all "+settings.transition+"s",cursor:"pointer",overflow:"hidden"}),items.find("*").css({"max-width":settings.size,"max-height":settings.size}),a('<div class="wall-overlay"></div>').appendTo(items).css({position:"absolute",top:"0px",left:"0px",width:"1000px",height:"1000px",background:"rgba(0,0,0,0)","z-index":10})}function g(){wall.mousemove(function(){x=event.pageX,y=event.pageY,moveX=x-startLeft,Math.abs(moveX)<=settings.threshold&&(moveX=0),moveX/=startLeft,moveY=y-startTop,Math.abs(moveY)<=settings.threshold&&(moveY=0),moveY/=startTop,d()})}function h(a){a.clone(!0).appendTo(wall).css({transition:"1s",transform:"rotateY(0deg) translateZ("+(-settings.depth*settings.scale+"px"),"z-index":15,left:startLeft-settings.size/2,top:startTop-settings.size/2,cursor:"default"}).addClass("wall-active").find(".wall-overlay").remove()}function i(b){var c=a(".wall-active").attr("data-wall-id");switch(b){case"back":c--,0>c&&(c=items.length-1);break;case"next":c++,c>=items.length&&(c=0)}a(".wall-active").remove(),h(a("[data-wall-id="+c+"]"))}return settings=a.extend({size:180,rows:3,angle:10,scale:1.1,variationY:.15,variationX:2,depth:-1200,perspective:2e3,threshold:0,transition:0,selector:"article",lightbox:"rgba(0,0,0,0.1)",btnback:"<",btnnext:">"},b),this.each(function(){wall=a(this),items=wall.children(settings.selector),startLeft=a(window).width()/2,startTop=a(window).height()/2,moveX=0,moveY=0,itemId=0,c(),e(startLeft,startTop),d(),f(),g(),a(window).resize(function(){startLeft=a(window).width()/2,startTop=a(window).height()/2,e(startLeft,startTop)}),items.on("click",function(){h(a(this)),a(".wall-lightbox").fadeIn()}),a(".wall-lightbox").on("click",function(b){b.target===this&&(a(".wall-lightbox").fadeOut(),a(".wall-active").remove())}),a(".wall-back").on("click",function(){i("back")}),a(".wall-next").on("click",function(){i("next")})})}}(jQuery);
